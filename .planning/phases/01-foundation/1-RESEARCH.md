# Phase 1: Foundation - Research

**Researched:** 2026-02-20
**Domain:** Next.js 16 App Router scaffolding, next-intl bilingual routing, next/font/local, TailwindCSS 4 brand tokens, GSAP centralized setup
**Confidence:** HIGH

---

<phase_requirements>
## Phase Requirements

| ID | Description | Research Support |
|----|-------------|-----------------|
| FNDN-01 | Project scaffolded with Next.js 16, TailwindCSS 4, shadcn/ui, TypeScript strict mode | create-next-app with Turbopack + `npx shadcn@latest init` with `--style new-york`; `@theme inline` pattern in globals.css |
| FNDN-02 | next-intl configured with [locale] routing (RO primary, EN secondary) with static rendering | `defineRouting()`, `setRequestLocale()`, `generateStaticParams()`, `createNavigation()`, proxy.ts (not middleware.ts in Next.js 16) |
| FNDN-03 | Custom fonts loaded via next/font/local (Glacial Indifference, Red Hat Display, Inter) with size-adjust fallbacks | `localFont({ src, variable, display: 'swap', adjustFontFallback: 'Arial' })` + CSS variable injection on `<html>` |
| FNDN-05 | GSAP + Motion animation infrastructure with SSR-safe patterns (useGSAP hook, LazyMotion, "use client" isolation) | `@gsap/react` useGSAP + `gsap.registerPlugin()` in centralized `lib/gsap.ts` + "use client" isolation |
| FNDN-06 | Responsive layout system (320px to 2560px, mobile-first, 48x48px tap targets) | TailwindCSS 4 responsive utilities, mobile-first breakpoints, min-h/min-w tap target tokens in `@theme` |
</phase_requirements>

---

## Summary

Phase 1 establishes every infrastructure concern that all later phases depend on: a working build, bilingual static routing, zero-CLS fonts, a centralized animation library, and brand tokens. The biggest risk in this phase is the **static rendering requirement for next-intl** — getting `○` (static) symbols in the Next.js build output requires `setRequestLocale()` in every layout and page, plus `generateStaticParams()` in the `[locale]` segment. Miss either one and the entire site shifts to dynamic `λ` rendering, breaking the PageSpeed 90+ goal.

The second risk is **font CLS**. Glacial Indifference is a custom font with no Google Fonts fallback. Using `next/font/local` with `display: 'swap'` and `adjustFontFallback: 'Arial'` prevents layout shift by auto-generating a size-adjusted system fallback. Without this, any font swap between Arial and Glacial Indifference will produce visible reflow.

The third risk is **GSAP in Next.js 16 with React 19**. GSAP's `useGSAP()` hook from `@gsap/react` uses `useIsomorphicLayoutEffect` internally, making it SSR-safe. However, plugin registration (ScrollTrigger, etc.) must happen in a centralized `"use client"` module, never at the module level of Server Components. All components using GSAP must carry `"use client"`.

**Primary recommendation:** Scaffold with `create-next-app@latest` (Turbopack default), add next-intl 4.x with `defineRouting`, configure shadcn with `npx shadcn@latest init --style new-york`, load fonts as CSS variables via `next/font/local`, and create `src/lib/gsap.ts` as the single plugin registration point.

---

## Standard Stack

### Core

| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| next | 16.x (latest) | App Router framework | Required by project spec; Turbopack default in v16 |
| react / react-dom | 19.2 | UI runtime | Bundled with Next.js 16; React Compiler stable |
| typescript | 5.x (strict) | Type safety | Project requirement; Next.js 16 requires TS 5.1+ |
| tailwindcss | 4.x | Utility CSS | Project spec; `@theme inline` replaces tailwind.config.js |
| @shadcn/ui (CLI) | shadcn@latest | Component scaffolding | CLI generates owned components, not a runtime package |
| next-intl | 4.x | i18n routing + translations | Project spec; v4 is current stable for Next.js 16 |
| gsap | 3.13+ | Timeline/scroll animations | Project spec; v3.13 includes useGSAP stable |
| @gsap/react | latest | useGSAP hook | Official React adapter; SSR-safe via useIsomorphicLayoutEffect |
| motion (framer-motion) | 11.x | Component-level transitions | Project spec for LazyMotion scroll reveals |

### Supporting

| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| tw-animate-css | latest | CSS animations for shadcn | Replaces tailwindcss-animate; shadcn@latest installs automatically |
| lucide-react | latest | Icon set | shadcn default; project spec |
| clsx + tailwind-merge | latest | Conditional class merging | `cn()` utility; included by shadcn init |
| @types/node, @types/react | latest | TypeScript definitions | Generated by create-next-app |

### Alternatives Considered

| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| next-intl | next-international | next-intl has 385 Context7 snippets, active maintenance, official Next.js integration guides; next-international is lighter but less featured |
| @gsap/react useGSAP | Manual useEffect + gsap.context() | useGSAP is the official pattern; handles Strict Mode double-invoke and cleanup automatically |
| tw-animate-css | tailwindcss-animate | tailwindcss-animate is deprecated for Tailwind v4; tw-animate-css is the replacement |
| motion (LazyMotion) | Full framer-motion import | LazyMotion reduces bundle size by ~75% by loading features on demand |

**Installation:**
```bash
# 1. Scaffold
npx create-next-app@latest aceagency --typescript --tailwind --eslint --app --turbopack

# 2. shadcn/ui (Tailwind v4 aware)
npx shadcn@latest init
# Select: New York style, Neutral base color, CSS variables: yes

# 3. i18n
npm install next-intl

# 4. Animations
npm install gsap @gsap/react motion

# 5. shadcn components (add as needed)
npx shadcn@latest add button card input label separator
```

---

## Architecture Patterns

### Recommended Project Structure

```
src/
├── app/
│   └── [locale]/            # next-intl locale segment
│       ├── layout.tsx        # setRequestLocale() + NextIntlClientProvider
│       └── page.tsx          # setRequestLocale() + useTranslations()
├── i18n/
│   ├── routing.ts            # defineRouting({ locales, defaultLocale })
│   ├── navigation.ts         # createNavigation(routing) exports Link, useRouter
│   └── request.ts            # getRequestConfig() for server-side locale resolution
├── lib/
│   └── gsap.ts               # "use client" — centralized registerPlugin()
├── components/
│   ├── ui/                   # shadcn-generated components
│   ├── layout/               # Header, Footer, Navigation
│   ├── sections/             # Page sections
│   └── animations/           # Wrappers: ScrollReveal, Parallax
├── styles/
│   └── globals.css           # @import tailwindcss + @theme inline brand tokens
├── messages/
│   ├── ro.json               # Romanian translations (primary)
│   └── en.json               # English translations
└── proxy.ts                  # next-intl middleware (Next.js 16 naming)
```

---

### Pattern 1: next-intl Static Routing Setup

**What:** Configures bilingual `[locale]` routing to render statically (`○`) not dynamically (`λ`) in the Next.js build output.

**When to use:** Required at project initialization. Every layout and page in `app/[locale]/` must call this.

```typescript
// src/i18n/routing.ts
// Source: https://github.com/amannn/next-intl/blob/main/docs/src/pages/docs/routing/setup.mdx
import { defineRouting } from 'next-intl/routing';

export const routing = defineRouting({
  locales: ['ro', 'en'],
  defaultLocale: 'ro',
  localePrefix: 'always', // /ro/... and /en/... always visible
});
```

```typescript
// src/i18n/navigation.ts
// Source: https://next-intl.dev/docs/routing/setup
import { createNavigation } from 'next-intl/navigation';
import { routing } from './routing';

export const { Link, redirect, usePathname, useRouter, getPathname } =
  createNavigation(routing);
```

```typescript
// src/i18n/request.ts
import { getRequestConfig } from 'next-intl/server';
import { hasLocale } from 'next-intl';
import { routing } from './routing';

export default getRequestConfig(async ({ requestLocale }) => {
  const requested = await requestLocale;
  const locale = hasLocale(routing.locales, requested)
    ? requested
    : routing.defaultLocale;

  return {
    locale,
    messages: (await import(`../messages/${locale}.json`)).default,
  };
});
```

```typescript
// proxy.ts (root of project — NOTE: Next.js 16 uses proxy.ts not middleware.ts)
// Source: https://next-intl.dev/docs/routing/middleware
import createMiddleware from 'next-intl/middleware';
import { routing } from './src/i18n/routing';

export default createMiddleware(routing);

export const config = {
  matcher: ['/((?!api|trpc|_next|_vercel|.*\\..*).*)'],
};
```

```typescript
// src/app/[locale]/layout.tsx
// Source: https://github.com/amannn/next-intl/blob/main/docs/src/pages/docs/routing/setup.mdx
import { setRequestLocale } from 'next-intl/server';
import { hasLocale } from 'next-intl';
import { notFound } from 'next/navigation';
import { routing } from '@/i18n/routing';
import { NextIntlClientProvider } from 'next-intl';

type Props = {
  children: React.ReactNode;
  params: Promise<{ locale: string }>;
};

export function generateStaticParams() {
  return routing.locales.map((locale) => ({ locale }));
}

export default async function LocaleLayout({ children, params }: Props) {
  const { locale } = await params;

  if (!hasLocale(routing.locales, locale)) {
    notFound();
  }

  // CRITICAL: Must be called before any next-intl API usage
  setRequestLocale(locale);

  return (
    <html lang={locale}>
      <body>
        <NextIntlClientProvider>{children}</NextIntlClientProvider>
      </body>
    </html>
  );
}
```

```typescript
// src/app/[locale]/page.tsx
// Source: https://github.com/amannn/next-intl/blob/main/docs/src/pages/docs/routing/setup.mdx
import { use } from 'react';
import { setRequestLocale } from 'next-intl/server';
import { useTranslations } from 'next-intl';

export default function HomePage({ params }: { params: Promise<{ locale: string }> }) {
  const { locale } = use(params);
  setRequestLocale(locale); // Must call in every page
  const t = useTranslations('HomePage');
  return <h1>{t('title')}</h1>;
}
```

---

### Pattern 2: Custom Fonts via next/font/local (Zero CLS)

**What:** Loads custom fonts entirely server-side, generating size-adjusted fallbacks to prevent CLS.

**When to use:** Defined once in the locale layout, CSS variables applied to `<html>` so all child components can reference them.

```typescript
// src/app/[locale]/layout.tsx (font section)
// Source: https://github.com/vercel/next.js/blob/v16.1.6/docs/01-app/03-api-reference/02-components/font.mdx
import localFont from 'next/font/local';
import { Inter } from 'next/font/google';

const glacialIndifference = localFont({
  src: [
    {
      path: '../../../public/fonts/GlacialIndifference-Regular.woff2',
      weight: '400',
      style: 'normal',
    },
    {
      path: '../../../public/fonts/GlacialIndifference-Bold.woff2',
      weight: '700',
      style: 'normal',
    },
  ],
  variable: '--font-glacial',
  display: 'swap',
  adjustFontFallback: 'Arial', // Auto-generates size-matched fallback
});

const redHatDisplay = localFont({
  src: '../../../public/fonts/RedHatDisplay-Regular.woff2',
  variable: '--font-red-hat',
  display: 'swap',
  adjustFontFallback: 'Arial',
});

const inter = Inter({
  subsets: ['latin'],
  variable: '--font-inter',
  display: 'swap',
});

// Apply all three variables to <html>
// In layout: className={`${glacialIndifference.variable} ${redHatDisplay.variable} ${inter.variable}`}
```

**Font file sourcing note:** Glacial Indifference is a free font available from multiple sources (fontsquirrel, etc.). Red Hat Display is available from Google Fonts as a download. Both must be placed in `public/fonts/` as `.woff2` files. Verify licensing before production use.

---

### Pattern 3: TailwindCSS 4 Brand Tokens via @theme inline

**What:** Defines brand colors as CSS custom properties in `:root`, then exposes them to Tailwind's utility generation via `@theme inline`.

**When to use:** All brand colors, fonts, spacing, and radius values belong here. No `tailwind.config.js` needed in v4.

```css
/* src/styles/globals.css */
/* Source: shadcn/ui v4 manual installation docs */
@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

/* 1. Define raw CSS variables */
:root {
  /* AceAgency Brand Colors */
  --color-electric-violet: #650CBE;
  --color-cobalt-blue: #4500D0;
  --color-electric-mint: #66F3A6;
  --color-black: #262523;
  --color-white: #FFFFFF;
  --color-grey: #D9D9D9;
  --color-burgundy: #56151A;

  /* shadcn/ui semantic tokens (oklch) */
  --background: oklch(0.145 0 0);        /* #262523 dark bg */
  --foreground: oklch(0.985 0 0);
  --primary: oklch(0.44 0.21 292);       /* ~#650CBE electric violet */
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.35 0.25 270);     /* ~#4500D0 cobalt blue */
  --accent: oklch(0.88 0.17 155);        /* ~#66F3A6 electric mint */
  --border: oklch(0.269 0 0);
  --input: oklch(0.269 0 0);
  --ring: oklch(0.44 0.21 292);
  --radius: 0.5rem;
}

/* 2. Expose to Tailwind utility generation */
@theme inline {
  /* Brand utilities: bg-electric-violet, text-cobalt-blue, etc. */
  --color-electric-violet: var(--color-electric-violet);
  --color-cobalt-blue: var(--color-cobalt-blue);
  --color-electric-mint: var(--color-electric-mint);
  --color-black: var(--color-black);
  --color-grey: var(--color-grey);
  --color-burgundy: var(--color-burgundy);

  /* shadcn semantic tokens */
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-accent: var(--accent);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);

  /* Font families */
  --font-heading: var(--font-glacial);
  --font-subheading: var(--font-red-hat);
  --font-body: var(--font-inter);

  /* Responsive tap target */
  --spacing-tap: 48px;
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground font-body;
    font-size: 16px; /* Minimum per project rules */
  }
  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-heading);
  }
}
```

---

### Pattern 4: Centralized GSAP Setup (SSR-Safe)

**What:** Registers all GSAP plugins in a single `"use client"` module so they are registered exactly once, before any component imports them.

**When to use:** Any component that uses GSAP or ScrollTrigger imports from `@/lib/gsap` instead of directly from `gsap`.

```typescript
// src/lib/gsap.ts
// Source: https://gsap.com/resources/React + BSMNT pattern
'use client';

import gsap from 'gsap';
import { useGSAP } from '@gsap/react';
import { ScrollTrigger } from 'gsap/ScrollTrigger';

// Register plugins once — tree-shaking prevention
gsap.registerPlugin(useGSAP, ScrollTrigger);

// Global defaults (optional, establishes consistent rhythm)
gsap.defaults({
  ease: 'power2.out',
  duration: 0.6,
});

export { gsap, useGSAP, ScrollTrigger };
```

```typescript
// src/components/animations/ScrollReveal.tsx
// Usage example — any component using GSAP
'use client'; // Required: useGSAP uses useLayoutEffect

import { useRef } from 'react';
import { gsap, useGSAP, ScrollTrigger } from '@/lib/gsap';

interface ScrollRevealProps {
  children: React.ReactNode;
  className?: string;
}

export function ScrollReveal({ children, className }: ScrollRevealProps): JSX.Element {
  const containerRef = useRef<HTMLDivElement>(null);

  useGSAP(
    () => {
      gsap.from(containerRef.current, {
        opacity: 0,
        y: 40,
        duration: 0.8,
        scrollTrigger: {
          trigger: containerRef.current,
          start: 'top 85%',
          toggleActions: 'play none none none',
        },
      });
    },
    { scope: containerRef }
  );

  return (
    <div ref={containerRef} className={className}>
      {children}
    </div>
  );
}
```

**SSR safety:** `useGSAP()` from `@gsap/react` uses `useIsomorphicLayoutEffect` internally — it runs `useLayoutEffect` in browser and falls back to `useEffect` on server. No `typeof window` guards needed inside the hook.

---

### Pattern 5: Responsive Layout Foundation

**What:** Mobile-first grid and container utilities, with minimum 320px support and 48×48px tap targets.

```css
/* In globals.css @theme inline */
@theme inline {
  --breakpoint-xs: 320px;   /* Minimum supported */
  --breakpoint-sm: 640px;
  --breakpoint-md: 768px;
  --breakpoint-lg: 1024px;
  --breakpoint-xl: 1280px;
  --breakpoint-2xl: 1536px;
  --breakpoint-3xl: 2560px; /* Maximum supported */

  --spacing-tap: 3rem;       /* 48px tap targets */
}
```

```typescript
// src/components/layout/Container.tsx
interface ContainerProps {
  children: React.ReactNode;
  className?: string;
}

export function Container({ children, className }: ContainerProps): JSX.Element {
  return (
    <div className={`mx-auto w-full max-w-[1280px] px-4 sm:px-6 lg:px-8 ${className ?? ''}`}>
      {children}
    </div>
  );
}
```

---

### Anti-Patterns to Avoid

- **Using `middleware.ts` in Next.js 16**: Middleware is deprecated — must use `proxy.ts`. The old file still works but triggers deprecation warnings and will be removed in a future version.
- **Not calling `setRequestLocale()` in every page/layout**: Missing this in even one page causes that page to render dynamically (`λ` in build output), violating the static rendering success criterion.
- **Registering GSAP plugins inside component files**: Causes duplicate registrations and potential race conditions. Always centralize in `lib/gsap.ts`.
- **Using `useGSAP()` in Server Components**: The hook requires browser APIs — any file with `useGSAP` must have `"use client"` at the top.
- **Importing fonts outside `next/font`**: Using `<link rel="stylesheet">` or `@font-face` in CSS bypasses Next.js's font optimization and disables CLS prevention.
- **Defining brand colors only in Tailwind classes**: Colors must also be CSS custom properties so GSAP and Framer Motion can animate them, and so they are accessible in inline styles.
- **Using `tailwindcss-animate`**: Deprecated for Tailwind v4. Use `tw-animate-css` instead.
- **Shadcn "default" style**: Deprecated in favor of "new-york" style in shadcn@latest.
- **Forgetting `adjustFontFallback`**: Without it, `next/font/local` does not generate a size-adjusted system fallback, causing CLS on first paint.
- **Direct `params` access without `await`**: Next.js 16 enforces async `params` — `const { locale } = await params` (not destructuring synchronously).

---

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Locale routing + static rendering | Custom locale middleware | next-intl `defineRouting` + `createMiddleware` | Headers manipulation for static rendering is complex; next-intl handles `x-next-intl-locale` header correctly |
| Font CLS elimination | Manual `@font-face` with fallback | `next/font/local` with `adjustFontFallback` | Auto-calculates `size-adjust`, `ascent-override`, `descent-override` per-font |
| GSAP cleanup in React Strict Mode | Custom `useLayoutEffect` with `gsap.context()` | `useGSAP()` from `@gsap/react` | Strict Mode double-invokes effects; `useGSAP` handles this correctly |
| Tailwind config for brand colors | `tailwind.config.js` `extend.colors` | `@theme inline` in CSS | Tailwind v4 eliminates the JS config; CSS-native approach works with any tool |
| Type-safe locale navigation | Custom `Link` with locale prop | `createNavigation(routing)` from next-intl | Generates typed `Link`, `useRouter`, `redirect` with locale-awareness baked in |

**Key insight:** All four infrastructure concerns (routing, fonts, animations, tokens) have first-class library support with Next.js 16. Building custom solutions would require re-implementing the exact same edge cases these libraries already handle.

---

## Common Pitfalls

### Pitfall 1: Dynamic Rendering Leak from Missing setRequestLocale

**What goes wrong:** Build output shows `λ` (dynamic) instead of `○` (static) for locale pages. The entire route tree becomes server-rendered on every request. PageSpeed suffers, TTFB degrades.

**Why it happens:** next-intl reads locale from `x-next-intl-locale` request header by default. Reading headers forces dynamic rendering in Next.js. `setRequestLocale()` bypasses the header and reads from the in-memory React cache instead.

**How to avoid:** Call `setRequestLocale(locale)` as the first statement in every layout.tsx and page.tsx inside `app/[locale]/`. It must be called before any next-intl API (`useTranslations`, `getTranslations`, etc.).

**Warning signs:** `λ` in `npm run build` output for any `[locale]` page.

---

### Pitfall 2: Font Files Not Found at Build Time

**What goes wrong:** `next/font/local` throws `Could not find font file` at build time, or at runtime in development.

**Why it happens:** The `src` path in `localFont({ src: ... })` is resolved relative to the file where `localFont()` is called, not relative to the project root.

**How to avoid:** If fonts are in `public/fonts/`, and the layout is at `src/app/[locale]/layout.tsx`, the path is `'../../../public/fonts/YourFont.woff2'`. Alternatively, colocate font files inside `src/app/` for simpler relative paths: `'./fonts/YourFont.woff2'`.

**Warning signs:** Build errors mentioning font file paths; missing fonts in development.

---

### Pitfall 3: GSAP ScrollTrigger Not Refreshing After Hydration

**What goes wrong:** ScrollTrigger positions are calculated before all content is rendered, causing trigger points to be off by the height of late-rendered elements.

**Why it happens:** Next.js hydrates components asynchronously. ScrollTrigger calculates positions on `DOMContentLoaded`, but dynamic content (images, fonts, translated text) may shift layout after this point.

**How to avoid:** Call `ScrollTrigger.refresh()` after fonts and images load. Use `ScrollTrigger.addEventListener('refresh', ...)` for layout-change callbacks. Add `height` and `width` to all `<Image>` components to reserve space.

**Warning signs:** Animations trigger too early or too late relative to their target elements.

---

### Pitfall 4: next-intl proxy.ts Matcher Accidentally Blocking API Routes

**What goes wrong:** API routes (`/api/...`) or static assets (`/_next/...`) get processed by the next-intl middleware, causing redirect loops or 404 errors.

**Why it happens:** Overly broad `matcher` in `proxy.ts` config.

**How to avoid:** Use the exact matcher pattern from next-intl docs:
```typescript
export const config = {
  matcher: ['/((?!api|trpc|_next|_vercel|.*\\..*).*)'],
};
```
This excludes API routes, internal Next.js routes, Vercel internals, and files with extensions.

**Warning signs:** 404 errors on static assets in development; API routes returning locale redirects.

---

### Pitfall 5: shadcn/ui CSS Variable Conflicts with Brand Tokens

**What goes wrong:** shadcn's `--primary` variable conflicts with the brand's `--color-electric-violet`, causing incorrect colors in shadcn components or vice versa.

**Why it happens:** shadcn uses semantic variable names (`--primary`, `--background`) that are separate from TailwindCSS utility variables (`--color-*`). Overwriting shadcn semantics with brand values without updating both layers causes inconsistency.

**How to avoid:** Keep two layers distinct:
1. Raw brand hex values: `--color-electric-violet: #650CBE` in `:root`
2. shadcn semantic layer: `--primary: oklch(...)` calculated to match the brand color
3. Tailwind `@theme inline` layer: maps both to utility classes

**Warning signs:** Buttons show wrong colors; shadcn components ignore brand palette.

---

### Pitfall 6: Cal.com embed React 19 peer dependency conflict

**What goes wrong:** `npm install @calcom/embed-react` fails with peer dependency error against React 19.

**Why it happens:** `@calcom/embed-react` v1.5.3 has an open peer dep issue (GitHub #20814) with React 19.

**How to avoid (Phase 1 action):** Run `npm install @calcom/embed-react` and check if the error occurs. If it does, document the conflict in STATE.md and plan to use the inline script fallback in Phase 5. This is a known STATE.md blocker.

**Warning signs:** `npm error ERESOLVE` mentioning `@calcom/embed-react` and React 19.

---

## Code Examples

Verified patterns from official sources:

### next-intl getRequestConfig (server-side locale resolution)

```typescript
// src/i18n/request.ts
// Source: https://next-intl.dev/docs/routing/setup
import { getRequestConfig } from 'next-intl/server';
import { hasLocale } from 'next-intl';
import { routing } from './routing';

export default getRequestConfig(async ({ requestLocale }) => {
  const requested = await requestLocale;
  const locale = hasLocale(routing.locales, requested)
    ? requested
    : routing.defaultLocale;

  return {
    locale,
    messages: (await import(`../messages/${locale}.json`)).default,
  };
});
```

### next.config.ts with next-intl plugin

```typescript
// next.config.ts
import type { NextConfig } from 'next';
import createNextIntlPlugin from 'next-intl/plugin';

const withNextIntl = createNextIntlPlugin('./src/i18n/request.ts');

const nextConfig: NextConfig = {
  // Turbopack is now the default in Next.js 16 — no opt-in needed
};

export default withNextIntl(nextConfig);
```

### Locale Switcher Component

```typescript
// src/components/layout/LocaleSwitcher.tsx
'use client';

import { useLocale } from 'next-intl';
import { useRouter, usePathname } from '@/i18n/navigation';
import { routing } from '@/i18n/routing';

export function LocaleSwitcher(): JSX.Element {
  const locale = useLocale();
  const router = useRouter();
  const pathname = usePathname();

  function handleSwitch(nextLocale: string): void {
    router.replace(pathname, { locale: nextLocale });
  }

  return (
    <nav aria-label="Language switcher">
      {routing.locales.map((loc) => (
        <button
          key={loc}
          onClick={() => handleSwitch(loc)}
          aria-current={locale === loc ? 'true' : undefined}
          className="min-h-tap min-w-tap" // 48px tap targets
        >
          {loc.toUpperCase()}
        </button>
      ))}
    </nav>
  );
}
```

### cn() Utility (required by shadcn components)

```typescript
// src/lib/utils.ts
// Source: shadcn/ui manual installation docs
import { clsx, type ClassValue } from 'clsx';
import { twMerge } from 'tailwind-merge';

export function cn(...inputs: ClassValue[]): string {
  return twMerge(clsx(inputs));
}
```

### next.config.ts typescript strict mode validation

```typescript
// tsconfig.json relevant strict options
{
  "compilerOptions": {
    "strict": true,
    "noUncheckedIndexedAccess": true,
    "noImplicitOverride": true
  }
}
```

---

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| `middleware.ts` | `proxy.ts` | Next.js 16 (Oct 2025) | Must rename file and export; old name still works but deprecated |
| `tailwind.config.js` extend.colors | `@theme inline` in CSS | Tailwind CSS v4 (early 2025) | No JS config needed; CSS-native theme |
| `tailwindcss-animate` | `tw-animate-css` | shadcn@latest / Tailwind v4 | Install `tw-animate-css`, import in globals.css |
| Sync `params` access | Async `await params` | Next.js 15 (enforced in 16) | Breaking: `const { locale } = params` → `const { locale } = await params` |
| `createLocalizedPathnamesNavigation` | `createNavigation` | next-intl 3.22+ | Simplified API; backwards compatible |
| `unstable_setRequestLocale` | `setRequestLocale` | next-intl 3.11+ | Stable API, no more `unstable_` prefix |
| shadcn "default" style | "new-york" style | shadcn@latest 2025 | "default" style deprecated; new-york is now the default |
| `experimental.turbopack: true` | Default bundler (no config) | Next.js 16 | Turbopack is now opt-out, not opt-in |
| `useLayoutEffect` in GSAP components | `useGSAP()` from @gsap/react | @gsap/react 2.x | Handles Strict Mode and SSR automatically |

**Deprecated/outdated:**
- `tailwindcss-animate`: Replaced by `tw-animate-css` for Tailwind v4 compatibility
- `createMiddleware` from `next-intl/middleware` (still works, but naming changes required for proxy.ts export)
- shadcn `"default"` style: Deprecated, use `"new-york"`
- `unstable_setRequestLocale`: Replaced by stable `setRequestLocale`
- `middleware.ts`: Deprecated in Next.js 16, use `proxy.ts`

---

## Open Questions

1. **Glacial Indifference WOFF2 availability**
   - What we know: Glacial Indifference is a free font; `.ttf` files are widely available
   - What's unclear: Whether `.woff2` variants are available or must be self-converted
   - Recommendation: Download TTF from a trusted source (fontsquirrel.com), convert to WOFF2 using `fonttools` or an online converter. Verify the font is genuinely free for commercial use (it is — created by Hanken Design Co.).

2. **next-intl version compatibility with Next.js 16**
   - What we know: next-intl docs reference `proxy.ts` for Next.js 16; `createMiddleware` function still works
   - What's unclear: Whether next-intl has a v4.x release or if v3.22+ is still current
   - Recommendation: Run `npm install next-intl@latest` and check the installed version. The API used here (`defineRouting`, `createNavigation`, `setRequestLocale`, `hasLocale`) is stable across v3.x and any v4.x release.

3. **Red Hat Display font license for local hosting**
   - What we know: Red Hat Display is open-source (SIL Open Font License)
   - What's unclear: Whether self-hosting the WOFF2 is permitted (it is, under OFL)
   - Recommendation: Download from fonts.google.com or the official Red Hat GitHub repo. Safe to self-host.

4. **Cal.com embed React 19 peer dep (KNOWN BLOCKER)**
   - What we know: `@calcom/embed-react` v1.5.3 has open GitHub issue #20814 with React 19
   - What's unclear: Whether the issue is resolved in a newer version
   - Recommendation: Test `npm install @calcom/embed-react` during Phase 1 scaffold. If it fails, use `--legacy-peer-deps` flag and test functionality, OR plan for inline script fallback. Document result in STATE.md.

---

## Sources

### Primary (HIGH confidence)
- `/amannn/next-intl` (Context7) — `setRequestLocale`, `defineRouting`, `generateStaticParams`, `createNavigation`, middleware/proxy setup
- `/vercel/next.js/v16.1.6` (Context7) — `next/font/local`, `adjustFontFallback`, CSS variable fonts, multiple font setup
- `/llmstxt/gsap_llms_txt` (Context7) — `useGSAP` hook, SSR safety, cleanup, `@gsap/react` installation
- `/shadcn-ui/ui/shadcn_3_2_1` (Context7) — `components.json`, `@theme inline`, CSS variable structure, `tw-animate-css`
- [Next.js 16 Official Release Blog](https://nextjs.org/blog/next-16) — proxy.ts naming, breaking changes, Turbopack default, async params enforcement
- [next-intl Official Setup Guide](https://next-intl.dev/docs/routing/setup) — complete proxy.ts matcher, `getRequestConfig`, project structure

### Secondary (MEDIUM confidence)
- [shadcn/ui Tailwind v4 Guide](https://ui.shadcn.com/docs/tailwind-v4) — `@theme inline` migration, `tw-animate-css`, new-york style default
- [BSMNT GSAP + Next.js Setup](https://basement.studio/blog/gsap-next-js-setup-the-bsmnt-way) — centralized `lib/gsap.ts` pattern, global defaults, `useIsomorphicLayoutEffect` pattern
- [Tailwind CSS v4 Theme Variables Docs](https://tailwindcss.com/docs/theme) — `@theme inline` directive, `--color-*` naming convention

### Tertiary (LOW confidence)
- Medium article on GSAP 2025 setup (blocked 403) — could not verify centralized setup details; BSMNT source used instead

---

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH — verified via Context7 official docs and Next.js 16 release blog
- Architecture: HIGH — patterns sourced directly from next-intl and Next.js official docs
- Pitfalls: HIGH for routing/font pitfalls (verified against official docs); MEDIUM for Cal.com issue (known STATE.md entry, not re-verified)
- Code examples: HIGH — all examples sourced from Context7 or official documentation

**Research date:** 2026-02-20
**Valid until:** 2026-03-22 (30 days — stable libraries; next-intl and shadcn are fast-moving so re-verify if delayed)
